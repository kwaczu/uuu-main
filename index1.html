<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Generator Projektów z Obrazkami Lokalnie</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      h1 {
        text-align: center;
      }
      form,
      .file-load {
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-width: 400px;
        margin: auto;
      }
      input,
      button {
        padding: 8px;
        font-size: 16px;
      }
      .gallery {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
      }
      .card {
        border: 1px solid #ccc;
        border-radius: 8px;
        overflow: hidden;
        width: 250px;
      }
      .card img {
        width: 100%;
        height: 150px;
        object-fit: cover;
      }
      .card p {
        padding: 10px;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <h1>Generator Projektów z Obrazkami Lokalnie</h1>

    <!-- Wczytanie JSON -->
    <div class="file-load">
      <label>Wczytaj plik JSON:</label>
      <input type="file" id="jsonFile" accept=".json" />
    </div>

    <!-- Formularz dodawania projektu -->
    <form id="projectForm">
      <input type="text" id="title" placeholder="Tytuł projektu" required />
      <input
        type="text"
        id="description"
        placeholder="Opis projektu"
        required
      />
      <input type="file" id="imageFile" accept="image/*" required />
      <button type="submit">Dodaj projekt</button>
    </form>

    <!-- Przyciski pobrania JSON -->
    <div style="text-align: center; margin-bottom: 20px">
      <button id="downloadBtn">Pobierz JSON z projektami</button>
    </div>

    <!-- Galeria projektów -->
    <div class="gallery" id="gallery-container"></div>

    <script>
      let projects = []; // wszystkie projekty
      const container = document.getElementById("gallery-container");
      const form = document.getElementById("projectForm");
      const jsonFileInput = document.getElementById("jsonFile");
      const downloadBtn = document.getElementById("downloadBtn");

      // Renderowanie galerii
      function renderGallery() {
        container.innerHTML = "";
        projects.forEach((item) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
      <img src="${item.url}" alt="${item.title}">
      <p><strong>${item.title}</strong> – ${item.description}</p>
    `;
          container.appendChild(card);
        });
      }

      // Wczytywanie JSON
      jsonFileInput.addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function (evt) {
          try {
            const data = JSON.parse(evt.target.result);
            if (Array.isArray(data)) {
              projects = data;
              renderGallery();
            } else {
              alert("Niepoprawny format JSON (oczekiwano tablicy)");
            }
          } catch (err) {
            alert("Błąd parsowania JSON: " + err.message);
          }
        };
        reader.readAsText(file);
      });

      // Dodawanie projektu z lokalnym obrazkiem
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        const title = document.getElementById("title").value;
        const description = document.getElementById("description").value;
        const imageFile = document.getElementById("imageFile").files[0];
        if (!imageFile) return alert("Wybierz obrazek!");

        const reader = new FileReader();
        reader.onload = function (evt) {
          const url = evt.target.result; // base64
          const newProject = { title, description, url };
          projects.push(newProject);
          renderGallery();
          form.reset();
        };
        reader.readAsDataURL(imageFile);
      });

      // Pobranie JSON
      downloadBtn.addEventListener("click", function () {
        const blob = new Blob([JSON.stringify(projects, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "projekty.json";
        a.click();
        URL.revokeObjectURL(url);
      });
    </script>
  </body>
</html>
